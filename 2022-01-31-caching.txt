                             â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                              JANUARY 2022
                                Caching

                                  TEC
                             â”â”â”â”â”â”â”â”â”â”â”â”â”â”


                               2022-01-31


There are less â€œobvious user-facing changesâ€ this month, but a lot of
good work has been happening ğŸ™‚.


The cache continues to make strides
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Nine months ago, Ihor started working on the org-element cache. The
  cache has existed for a while now, but it used to be too buggy to be
  useful.

  This is no longer the case! Weâ€™re finally confident enough to flip
  `org-element-use-cache'â€™s default from `nil' to `t'. I mentioned some
  of the improvements in [November], however Ihor has continued to make
  strides with the cache.

  Getting the cache right is tough though, and so while the situation is
  much improved there are still lingering bugs which need to be chased
  down. If you only take one thing away from the post, Iâ€™d like it to be
  this:

  The cache is actively being developed now, for the first time in
  years, so:
  1. Ignore old advice (like [this]) which suggests disabling the cache
     â€¢ Note that the cache will /not/ stuff anything up, at worst it
       will emit a warning
  2. If you see an org-cache warning /please/ report it to the Org
     mailing list â€” `emacs-orgmode@gnu.org'.

  Cache warnings look something like this:
  â”Œâ”€â”€â”€â”€
  â”‚ Warning (org-element-cache): org-element--cache: Unregistered buffer modifications detected. Resetting.
  â”‚ If this warning appears regularly, please report the warning text to Org mode mailing list (M-x org-submit-bug-report).
  â”‚ The buffer is: config.org
  â”‚  Current command: (some-buggy-command)
  â”‚  Chars modified: 483
  â”‚  Buffer modified: 330957
  â”‚  Backtrace:
  â”‚ ...some possibly long backtrace...
  â””â”€â”€â”€â”€

  A good way to start is by copying this to your clipboard and then
  trying `M-x org-submit-bug-report'. Regardless of whether youâ€™re using
  an Emacs mail client, this will collect all the important information
  (org-mode version, etc.) and populate a buffer with it. Add the
  warning text, and that will be a great help!  After all, itâ€™s quite
  hard to fix bugs we donâ€™t know about ğŸ˜†.

  As of October 2021, â€œbulkâ€ heading promotion/demotion operations are
  now faster thanks to the cache, and there have now been further
  improvements relating to headings. It used to be the case that every
  time heading properties changed the entire heading (and contents) were
  re-parsed. Now, cache heuristics prevent the content from being
  entirely re-parsed (see
  `org-element--cache-avoid-synchronous-headline-re-parsing' for a bit
  more information). This improvement is particularly noticeable when
  refiling and archiving headings.


[November] <file:2021-11-30-element.org::Org element parser cache>

[this]
<https://emacs.stackexchange.com/questions/42006/trouble-with-org-mode>


Persisting data
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  In October, Ihor started work on `org-persist.el' â€” a way to /persist/
  data across Emacs sessions. You may wonder what sort of data is being
  persisted. Well, initially org-persist was written to record variable
  values associated with particular files or buffers â€” such as the
  org-element cache. This allows org-mode to load the cache for an Org
  file and avoid re-parsing much of the content.

  Over the past month, Ihor has /doubled/ the total number of commits
  applied to `org-persist.el' and now more kinds of data can be
  persisted, such as remote files (via. tramp) and online
  resources. This opens up a lot of new possibilities, and we can begin
  to see what this will allow for in the next highlight.


Exporting documents with remote resources
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Ever linked to an online image like
  `https://orgmode.org/resources/img/org-mode-unicorn.svg' in an Org
  document, seen it look nice in the HTML export and then be
  disappointed to just see a link in LaTeX? Well I have. Thankfully this
  is no longer the case though, thanks to a helper function
  `org-export-link-localise' thatâ€™s just been added to `ox.el'.

  Using `org-persist.el' this acquires a local copy of the remote
  resource and substitutes it in for the remote link. This is currently
  utilised in `ox-latex.el' to provide support for not just HTTPS links
  but also tramp files!

  <file:figures/ox-latex-image-link-localisation-demo.png>

  While this is currently only implemented for `ox-latex', this can be
  applied generally, and so thereâ€™s a good chance youâ€™ll hear more about
  this in the future.

  There are also thoughts of moving this to the links file (`ol.el')
  which would make this functionality more broadly accessible
  (e.g. using cached/local versions of a resource in other places, and
  defining custom downloaders for custom link types).


Other improvements
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  âƒ Produce less native-comp warnings _Ihor Radchenko_
  âƒ Add a header to the clock report table _Samim Pezeshki_
  âƒ More verbose test failure summary _Max Nikulin_
  âƒ Parallelise `make'ing the docs _Marco Wahl_
  âƒ More org-element tests _Ihor Radchenko_


Bugfixes
â•â•â•â•â•â•â•â•

  âƒ Fix formatting in elisp-link prompt _TEC_
  âƒ Correct some checkdoc and compiler warnings _Ihor Radchenko_
  âƒ Correct signature for `org-element-at-point' _Mark A. Hershberger_
  âƒ Fix the LaTeX macron accent in org-entities _TEC_
  âƒ Ignore narrowing when tangling a file _Nicolas Goaziou_
